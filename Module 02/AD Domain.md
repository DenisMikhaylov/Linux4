Упражнение 1: Развертывание AD DS

Сценарий

В рамках расширения бизнеса корпорация COPR хочет развернуть новые контроллеры домена на
удалённых сайтах с минимальным участием со стороны ИТ-персонала. Вы будете использовать Windows PowerShell для
развертывания новых контроллеров домена.

Основные задачи для этого упражнения следующие:
1. Установка двоичных файлов AD DS.
2. Подготовка установки AD DS и продвижение удалённого сервера.
3. Запуск анализатора передового опыта AD DS


Задача 1: Установка двоичных файлов AD DS
1. В диспетчере серверов щелкните Tools, а затем щелкните Windows PowerShell.
2. В командной строке интерфейса командной строки Windows PowerShell введите следующую
команду и нажмите Enter:
```
Install-WindowsFeature –Name AD-Domain-Services –ComputerName dc
```
4. Введите следующую команду, чтобы убедиться, что роль AD DS установлена ​​, а затем нажмите Enter:
```
Get-WindowsFeature –ComputerName dc
```
В выводе предыдущей команды прокрутите вверх и найдите Active Directory Domain Services.
Убедитесь, что этот флажок установлен. Найдите Remote Server Administration Tools. Найдите узел Role Administration Tools под ним, а затем найдите узел AD DS и AD LDS Tools
Настройка DNS сервера

Задача 2:Удаленная настройка AD DS с помощью диспетчера сервера

1. Убедитесь, что установка роли AD DS на ВС завершена и что сервер добавлен в диспетчер сервера. Затем щелкните символ флага Уведомления.
2. Обратите внимание на конфигурацию dc после развертывания, а затем щелкните ссылку Повысить этот сервер до контроллера домена.
3. В мастере настройки доменных служб Active Directory на странице Конфигурация развертывания в разделе Выбор операции развертывания выберите развернуть новый лес.
4. Укажите лес corp.ru
5. На странице «Параметры просмотра» нажмите «Просмотреть сценарий», чтобы открыть сгенерированный сценарий Windows PowerShell.
6. Скопируйте скрипт в блокнот.
7. Выполните установку.
  
Задача 3: Запуск анализатора соответствия рекомендациям AD DS

1. На DC в диспетчере серверов перейдите в представление панели мониторинга AD DS.
2. Прокрутите вниз до раздела Анализатор соответствия рекомендациям, щелкните меню Задачи, а затем щелкните Запустить сканирование BPA.
3. В диалоговом окне Выбор серверов выберите dc.corp.ru.
4. Щелкните Запустить сканирование, а затем подождите, пока анализатор соответствия рекомендациям (BPA) завершит сканирование.
5. Просмотрите результаты BPA


Настройка DNS
```
DNS→SERVER→Properties→Forwardes→8.8.8.8
```
Добавление пользователей в домен
Открыть Powershell
```
New-ADUser -Name "Ivan I. Ivanov" -DisplayName "Ivan I. Ivanov" -GivenName "Ivan" -Initials "I" -Surname "Ivanov" `
-SamAccountName "user1" -AccountPassword(ConvertTo-SecureString -AsPlainText 'Pa$$w0rd' -Force) `
-Enabled $true -ChangePasswordAtLogon $false

New-ADUser -Name "Petr P. Petrov" -DisplayName "Petr P. Petrov" -GivenName "Petr" -Initials "P" -Surname "Petrov" `
-SamAccountName "user2" -AccountPassword(ConvertTo-SecureString -AsPlainText 'Pa$$w0rd' -Force) `
-Enabled $true -ChangePasswordAtLogon $false
```

Настройка второго домен котроллера. (Не обязательно)

Упражнение 2: Развертывание контроллеров домена путем выполнения клонирования контроллера домена
Задача 1: Проверка предварительных условий клонирования контроллера домена
1. На dc в диспетчере серверов щелкните Инструменты, а затем щелкните Центр администрирования Active Directory.
2. В центре администрирования Active Directory дважды щелкните Adatum (local), а затем в списке управления дважды щелкните организационную единицу (OU) Контроллеры домена.
3. В списке управления выберите dc, если она еще не выбрана, а затем на панели Задачи в разделе dc щелкните Добавить в группу.
4. В диалоговом окне Выбор групп в поле Введите имена выбираемых объектов введите Клонируемый, а затем щелкните Проверить имена.
5. Убедитесь, что имя группы развернуто до Клонируемые контроллеры домена, а затем щелкните ОК.
6. На dc на панели задач щелкните значок Windows PowerShell.
7. В командной строке Windows PowerShell введите следующую команду и нажмите Enter:
```
Get-ADDCCloningExcludedApplicationList
```
9. Проверьте список критических приложений, если таковые имеются. (В рабочей среде проверьте каждое приложение или используйте контроллер домена, на котором по умолчанию установлено меньше приложений.) Введите следующую команду и нажмите Enter:
```
Get-ADDCCloningExcludedApplicationList –GenerateXML
```
10. Выполните следующую команду для создания файла DCCloneConfig.xml:
```
New-ADDCCloneConfigFile
```

Задача 2: Копирование исходного контроллера домена

1. Введите следующую команду для выключения dc, а затем нажмите Enter:
Stop-Computer
2. На хост-компьютере в диспетчере Hyper-V в списке управления выберите виртуальную машину dc.
3. На панели «Действия» в разделе dc нажмите «Экспорт».
4. В диалоговом окне «Экспорт виртуальной машины» введите местоположение d:\vm, а затем нажмите «Экспорт». Дождитесь завершения экспорта.
5. На панели «Действия» в разделе dc нажмите «Пуск», а затем войдите в систему как
corp\Administrator с паролем Pa55w.rd.
Задача 3: Выполнить клонирование контроллера домена
1. На хост-компьютере в диспетчере Hyper-V на панели Действия в разделе, названном по имени хост-компьютера, нажмите Импортировать виртуальную машину.
2. В мастере импорта виртуальных машин на странице Перед началом работы нажмите Далее.
3. На странице Найти папку нажмите Обзор, перейдите в папку D:\vm\dc, нажмите Выбрать папку, а затем нажмите Далее.
4. На странице Выбор виртуальной машины выберите dc (если она еще не выбрана), а затем нажмите Далее.
5. На странице Выбор типа импорта выберите Копировать виртуальную машину (создать новый уникальный идентификатор), а затем нажмите Далее.
6. На странице Выбор папок для файлов виртуальной машины установите флажок Сохранить виртуальную машину в другом месте.
7. Для каждого расположения папки укажите D:\vm\ в качестве пути, а затем нажмите кнопку Далее.
8. На странице Выбор папок для хранения виртуальных жестких дисков укажите путь D:\vm\, а затем нажмите кнопку Далее.
9. На странице Завершение мастера импорта нажмите кнопку Готово.
10. В списке управления найдите и выберите недавно импортированную виртуальную машину с именем
dc, состояние которой отображается как Выкл. В нижней части панели Действия нажмите кнопку Переименовать.
11. Введите dc2 в качестве имени, а затем нажмите клавишу Enter.
12. На панели Действия в разделе dc2 нажмите кнопку Запустить, а затем нажмите кнопку Подключить, чтобы увидеть запуск виртуальной машины.
13. Во время запуска сервера вы можете увидеть сообщение «Клонирование контроллера домена завершено на x%».
